# 飞机大战简述 #

使用Cortex-M0+内核的STM32G030F6P6单片机制作一款蓝牙控制的飞机大战游戏。

# 蓝牙控制 #

通过手机APP与单片机进行蓝牙通信，以数据包的形式进行信息交换。

# 显示载体 #

以0.96寸IIC模式的OLED为显示载体。

# 游戏画面 #

目前游戏中有“背景”、“玩家角色”、“敌机”、“子弹”四种画面。

# 游戏设计思路 #

可以通过封装这四种内容，对它们分别管理，其中还需要考虑，如敌机对象有多个，如何同时管理多个敌机对象。

下方所展示的是整个游戏的运行逻辑：

![飞机大战运行逻辑](./drawio/AircraftWar.drawio.png)

## 游戏初始化 ##

玩家角色通常只有一个，可以先按照一个玩家角色去设计游戏。首先进入游戏需要进入初始化阶段，初始化阶段需要完成四个任务，它们分别是 `初始化显示载体`、`初始化游戏参数`、`初始化游戏场景`、`初始化玩家角色`，下面将分别进行介绍。

### 初始化显示载体 ###

游戏需要在一个显示载体上进行展示，这样才能够方便玩家游玩，我所选择的显示载体是0.96寸IIC模式SSD1306驱动的OLED，因此初始化阶段需要对其进行初始化，并提供一些简单的信息打印和线条绘制API，以便不时之需。

### 初始化游戏参数 ###

游戏参数能够为游戏设计提供更好的可移植性，好的参数设计可以简便移植过程。目前所设计的游戏参数有：`屏幕参数`。

    屏幕参数：
    typedef struct{
        uint16_t width;						// 显示载体宽度
        uint16_t height;					// 显示载体高度
        uint8_t pixelSize;					// 显示载体像素大小，可自行设定
        const unsigned char *bg;			// 背景
    }AW_Screen_t;

需要注意的是，在该模块中，任何对象的坐标都是以屏幕参数中的像素大小为单位的，但是对象的贴图宽度和高度如同屏幕参数中的显示载体宽度和高度一般，不受像素大小影响。

### 初始化游戏场景 ###

通常游戏场景的初始化是游戏背景的初始化，也就是说，这一步我们需要将初始化参数阶段获得的AW_Screen_t::bg成员传递给背景绘制API。

### 初始化玩家角色 ###

玩家角色通常只有一个，因此可以先将玩家角色设计成定义在源文件中的静态变量，如果想要访问这个静态变量，需要通过提供的API进行访问、修改等操作。同时，玩家角色结构体中还包含了数目为 `AW_PLAYER_BULLETS_NUM_MAX` 的子弹结构体，也即，一个玩家角色所能同时存在与显示载体中的子弹的最大数目为AW_PLAYER_BULLETS_NUM_MAX。

## 游戏进行中 ##

在游戏中，需要处理以下事件：`玩家角色移动和发射`、`敌机的生成和移动`、`子弹移动`、`显示载体的刷新`。

### 玩家角色移动和发射 ###

该系统通过BT接收命令数据包，解码之后调用飞机大战游戏模块相关API实现移动玩家角色和发射子弹。

### 敌机的生成和移动 ###

敌机将随机生成并朝向玩家角色而来。

### 子弹移动 ###

通过双向链表构建“无限大”的容器，将已经发射的子弹放进容器中，并通过自定义的回调函数实现子弹的飞行。

### 显示载体的刷新 ###

每当处理完一定的事件之后，将会刷新一次显示载体。

## 游戏结束 ##

游戏如果结束，将会判断是否重新开始下一局游戏。
